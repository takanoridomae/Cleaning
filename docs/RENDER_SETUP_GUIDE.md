# Render Persistent Disk 設定ガイド

## 🎯 目的
エアコンクリーニング報告書システムの写真データを永続化するためのPersistent Disk設定手順

## ⚠️ 前提条件
- Renderの有料プラン（Starter以上）に加入済み
- GitHubリポジトリとの連携完了
- Webサービスの基本デプロイ完了

## 📋 設定手順

### ステップ1: Persistent Diskの追加

1. **Renderダッシュボードにアクセス**
   - https://dashboard.render.com/ にログイン
   - 対象のWebサービスを選択

2. **Disksページに移動**
   - サイドメニューから「Disks」をクリック

3. **新しいディスクを作成**
   - 「Add Disk」ボタンをクリック
   - 以下の設定を入力：

#### 🔧 Disk設定
| 項目 | 設定値 | 説明 |
|------|--------|------|
| **Name** | `photo-storage` | ディスク名（任意） |
| **Mount Path** | `/opt/render/project/src/uploads` | **重要：この通りに入力** |
| **Size** | `1 GB` | 初期サイズ（後で拡張可能） |

4. **ディスクを保存**
   - 「Add Disk」ボタンをクリック
   - 自動的に再デプロイが開始されます

### ステップ2: デプロイ状況の確認

1. **ビルドログの確認**
   - 「Logs」タブでデプロイ状況を監視
   - 以下のメッセージが表示されることを確認：
   ```
   ✅ Persistent Diskが検出されました: /opt/render/project/src/uploads
   📂 新規Persistent Diskです
   ```

2. **デプロイ完了後の確認**
   - アプリケーションにアクセス
   - 写真アップロード機能をテスト

### ステップ3: 写真データのテスト

1. **写真アップロードのテスト**
   - 報告書編集画面で写真をアップロード
   - 正常に表示されることを確認

2. **永続性のテスト**
   - Renderダッシュボードで「Manual Deploy」を実行
   - 再デプロイ後も写真が残っているか確認

## 💰 料金について

### Persistent Disk料金
- **基本料金：** $0.25/GB/月
- **推奨サイズ：** 
  - 小規模使用：1GB（$0.25/月）
  - 中規模使用：5GB（$1.25/月）
  - 大規模使用：10GB（$2.50/月）

### サイズ拡張の目安
- **1枚あたり：** 1-5MB（画質による）
- **1000枚：** 約3-5GB
- **月100枚ペース：** 年間約4-6GB

## 🔧 トラブルシューティング

### 問題1: Persistent Diskが検出されない
**症状：** ログに「Persistent Diskが検出されませんでした」と表示

**解決策：**
1. Mount Pathが正確か確認：`/opt/render/project/src/uploads`
2. ディスク作成後に再デプロイが完了しているか確認
3. サービスプランがStarter以上か確認

### 問題2: 写真がアップロードできない
**症状：** アップロード時にエラーが発生

**解決策：**
1. ディスクの権限確認（自動設定されるはず）
2. ディスク容量の確認
3. アプリケーションログでエラー詳細を確認

### 問題3: 既存の写真が見えない
**症状：** 以前の写真が表示されない

**解決策：**
- Persistent Disk設定前の写真は復旧不可
- データベースの写真レコードのパス確認
- 必要に応じて写真の再アップロード

## 📊 監視とメンテナンス

### 容量監視
1. **Renderダッシュボード**
   - Disksページでストレージ使用量を定期確認
   - 80%使用時は拡張を検討

2. **アラート設定**
   - 容量不足の通知設定
   - バックアップ計画の策定

### バックアップ
- Renderは自動的に日次スナップショットを作成
- 7日間保持される
- 重要なタイミングでは手動スナップショット推奨

## ✅ 設定完了チェックリスト

- [ ] 有料プラン（Starter以上）に加入
- [ ] Persistent Disk作成（1GB以上）
- [ ] Mount Path設定：`/opt/render/project/src/uploads`
- [ ] デプロイ完了とログ確認
- [ ] 写真アップロードテスト
- [ ] 再デプロイテスト
- [ ] 容量監視設定

## 🎉 設定完了後の効果

✅ **再デプロイしても写真データが保持される**
✅ **安定した写真表示**
✅ **自動バックアップ機能**
✅ **高性能SSDによる高速アクセス**

---

設定に関してご不明な点がございましたら、お気軽にお尋ねください。 