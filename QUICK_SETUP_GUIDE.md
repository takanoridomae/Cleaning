# 緊急セットアップガイド - テーブルエラー解決

## 🚨 現在の問題
```
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
```

データベースにテーブルが存在しないため、アプリケーションがエラーになっています。

## ⚡ 即座の解決手順

### ステップ1: 強制初期化の実行

1. **Renderダッシュボードにアクセス**
   - [https://dashboard.render.com](https://dashboard.render.com)

2. **サービスを選択**
   - 該当のWebサービス（Cleaning）をクリック

3. **環境変数を一時的に追加**
   - **Environment** タブをクリック
   - **Add Environment Variable** をクリック
   - **Key**: `FORCE_DB_INIT`
   - **Value**: `true`
   - **Save Changes** をクリック

4. **手動デプロイ実行**
   - **Manual Deploy** → **Deploy latest commit** をクリック
   - デプロイ完了まで待機（数分）

5. **ログで確認**
   - **Logs** タブでデプロイログを確認
   - 「データベースの初期化が完了しました」のメッセージを確認

### ステップ2: 安全設定に戻す

6. **環境変数を削除**
   - **Environment** タブに戻る
   - `FORCE_DB_INIT` の右側の **Delete** をクリック
   - 削除を確認

7. **再度デプロイ（任意）**
   - 安全確認のため再度デプロイ
   - 今度はDB初期化がスキップされることを確認

## ✅ 完了後の確認

### アプリケーション動作確認
1. **アプリケーションURL**にアクセス
2. **ログインページ**が表示されることを確認
3. **初期ログイン情報**:
   - ユーザー名: `admin`
   - パスワード: `admin123`

### ログイン後の動作確認
- ダッシュボードが正常に表示される
- メニューが正常に動作する
- エラーが発生しない

## 🛡️ 今後の安全な運用

この初期化完了後は、以下のように運用してください：

1. **通常のデプロイ**
   - GitHubにプッシュ
   - Render手動デプロイ
   - ✅ データは保護される

2. **`FORCE_DB_INIT`は設定しない**
   - 通常運用では絶対に設定しない
   - データ消失を防ぐため

## 🔄 データインポート（必要な場合）

初期化完了後、既存データをインポートする場合：

1. **Render Shell**を起動
2. **基本データインポート**:
   ```bash
   python scripts/db_tools/import_to_render.py simple_export_20250624_185754.json
   ```
3. **報告書データインポート**:
   ```bash
   python scripts/db_tools/import_reports.py reports_export_20250624_191211.json
   ```

## 📝 この問題が発生した理由

- 新しい安全な設定により、デフォルトでDB初期化がスキップされる
- しかし、初回デプロイ時にはテーブル作成が必要
- 一度だけ強制初期化を実行することで解決

この手順により、安全かつ確実にアプリケーションが動作開始します。 